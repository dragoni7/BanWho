@page "/"
@inject IChampGameStatsService champGameStatsService
@inject IBanMeInfoService leagueDataService
@attribute [StreamRendering(true)]

<PageTitle>BanMe</PageTitle>

<center><h2>Recommended Bans</h2></center>

<br />
<br />

<div class="container">
	<div class="row row-cols-lg-5 gx-4">
		<div class="col">
			<center>
				<h3>Top</h3>
				@foreach (var entry in topBans)
				{
					<ChampEntry ChampionName="@entry.ChampionName" WinRate="@entry.TopWinRate" PickRate="@entry.TopPickRate" BanRate="@entry.BanRate" ImageSource=@GetChampSquare(entry.ChampionName) />					
				}
			</center>
		</div>
		<div class="col">
			<center>
				<h3>Mid</h3>
				@foreach (var entry in midbans)
				{
					<ChampEntry ChampionName="@entry.ChampionName" WinRate="@entry.MidWinRate" PickRate="@entry.MidPickRate" BanRate="@entry.BanRate" ImageSource=@GetChampSquare(entry.ChampionName) />
				}
			</center>
		</div>
		<div class="col">
			<center>
				<h3>Jungle</h3>
				@foreach (var entry in jungleBans)
				{
					<ChampEntry ChampionName="@entry.ChampionName" WinRate="@entry.JungleWinRate" PickRate="@entry.JunglePickRate" BanRate="@entry.BanRate" ImageSource=@GetChampSquare(entry.ChampionName) />
				}
			</center>
		</div>
		<div class="col">
			<center>
				<h3>Bot</h3>
				@foreach (var entry in botBans)
				{
					<ChampEntry ChampionName="@entry.ChampionName" WinRate="@entry.BotWinRate" PickRate="@entry.BotPickRate" BanRate="@entry.BanRate" ImageSource=@GetChampSquare(entry.ChampionName) />
				}
			</center>
		</div>
		<div class="col">
			<center>
				<h3>Supp</h3>
				@foreach (var entry in suppBans)
				{
					<ChampEntry ChampionName="@entry.ChampionName" WinRate="@entry.SuppWinRate" PickRate="@entry.SuppPickRate" BanRate="@entry.BanRate" ImageSource=@GetChampSquare(entry.ChampionName) />
				}
			</center>
		</div>
	</div>
</div>

@code {

	List<ChampGameStats> champGameStats = new();
	List<ChampGameStats> topBans = new();
	List<ChampGameStats> midbans = new();
	List<ChampGameStats> jungleBans = new();
	List<ChampGameStats> botBans = new();
	List<ChampGameStats> suppBans = new();

	private string currentPatch = "";

	protected override async Task OnInitializedAsync()
	{
		champGameStats = await champGameStatsService.GetAllChampGameStats();
		topBans = await champGameStatsService.GetRecommendedBans(Roles.TOP, 16);
		midbans = await champGameStatsService.GetRecommendedBans(Roles.MIDDLE, 16);
		jungleBans = await champGameStatsService.GetRecommendedBans(Roles.JUNGLE, 16);
		botBans = await champGameStatsService.GetRecommendedBans(Roles.BOTTOM, 16);
		suppBans = await champGameStatsService.GetRecommendedBans(Roles.SUPPORT, 16);

		currentPatch = await leagueDataService.GetLatestPatch();
	}

	protected string GetChampSquare(string champion)
	{
		return $"https://cdn.communitydragon.org/{currentPatch}/champion/{champion}/square";
	}
}

